<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extract Site Data from a local NASIS Database — get_site_data_from_NASIS_db • soilDB</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<meta property="og:title" content="Extract Site Data from a local NASIS Database — get_site_data_from_NASIS_db" />

<meta property="og:description" content="Get site-level data from a local NASIS database." />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">soilDB</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract Site Data from a local NASIS Database</h1>
    
    <div class="hidden name"><code>get_site_data_from_NASIS_db.Rd</code></div>
    </div>

    
    <p>Get site-level data from a local NASIS database.</p>
    

    <pre class="usage"><span class='fu'>get_site_data_from_NASIS_db</span>(<span class='kw'>SS</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>stringsAsFactors</span> <span class='kw'>=</span> <span class='fu'>default.stringsAsFactors</span>())</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>SS</th>
      <td><p>fetch data from Selected Set in NASIS or from the entire local database (default: TRUE)</p></td>
    </tr>
    <tr>
      <th>stringsAsFactors</th>
      <td><p>logical: should character vectors be converted to factors? This argument is passed to the uncode() function. It does not convert those vectors that have been set outside of uncode() (i.e. hard coded). The 'factory-fresh' default is TRUE, but this can be changed by setting options(stringsAsFactors = FALSE)</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A dataframe.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>When multiple "site bedrock" entries are present, only the shallowest is returned by this function.</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>This function currently works only on Windows.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='get_hz_data_from_NASIS_db.html'>get_hz_data_from_NASIS_db</a></code>,</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
</div><span class='co'># NOT RUN {</span>
<span class='co'>## Example: export / convert DMS coordinates from NASIS and save to DD import file</span>

<span class='co'># load required libraries</span>
<span class='fu'>library</span>(<span class='no'>soilDB</span>)
<span class='fu'>library</span>(<span class='no'>rgdal</span>)
<span class='fu'>library</span>(<span class='no'>plyr</span>)

<span class='co'># get site data from NASIS</span>
<span class='no'>s</span> <span class='kw'>&lt;-</span> <span class='fu'>get_site_data_from_NASIS_db</span>()

<span class='co'># keep only those pedons with real coordinates</span>
<span class='no'>good.idx</span> <span class='kw'>&lt;-</span> <span class='fu'>which</span>(!<span class='fu'>is.na</span>(<span class='no'>s</span>$<span class='no'>x</span>))
<span class='no'>s</span> <span class='kw'>&lt;-</span> <span class='no'>s</span>[<span class='no'>good.idx</span>, ]

<span class='co'># investigate multiple datums:</span>
<span class='no'>get_site_data_from_NASIS_db</span>

<span class='co'>## this is not universally appropriate!</span>
<span class='co'># assume missing is NAD83 </span>
<span class='no'>s</span>$<span class='no'>horizdatnm</span>[<span class='fu'>is.na</span>(<span class='no'>s</span>$<span class='no'>horizdatnm</span>)] <span class='kw'>&lt;-</span> <span class='st'>'NAD83'</span>

<span class='co'># check: OK</span>
<span class='fu'>table</span>(<span class='no'>s</span>$<span class='no'>horizdatnm</span>, <span class='kw'>useNA</span><span class='kw'>=</span><span class='st'>'always'</span>)

<span class='co'># convert to NAD83</span>
<span class='no'>old.coords</span> <span class='kw'>&lt;-</span> <span class='fu'>cbind</span>(<span class='no'>s</span>$<span class='no'>x</span>, <span class='no'>s</span>$<span class='no'>y</span>)

<span class='co'># add temp column for projection information, and fill with proj4 style info</span>
<span class='no'>s</span>$<span class='no'>proj4</span> <span class='kw'>&lt;-</span> <span class='fu'>rep</span>(<span class='fl'>NA</span>, <span class='kw'>times</span><span class='kw'>=</span><span class='fu'>nrow</span>(<span class='no'>s</span>))
<span class='no'>s</span>$<span class='no'>proj4</span> <span class='kw'>&lt;-</span> <span class='fu'>paste</span>(<span class='st'>'+proj=longlat +datum='</span>, <span class='no'>s</span>$<span class='no'>horizdatnm</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>''</span>)

<span class='co'># iterate over pedons, and convert to WGS84</span>
<span class='no'>new.coords</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/plyr/topics/ddply'>ddply</a></span>(<span class='no'>s</span>, <span class='st'>'siteiid'</span>,
  <span class='kw'>.progress</span><span class='kw'>=</span><span class='st'>'text'</span>, <span class='kw'>.fun</span><span class='kw'>=</span><span class='kw'>function</span>(<span class='no'>i</span>) {
    <span class='fu'>coordinates</span>(<span class='no'>i</span>) <span class='kw'>&lt;-</span> ~ <span class='no'>x</span> + <span class='no'>y</span>
    <span class='fu'>proj4string</span>(<span class='no'>i</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/rgdal/topics/CRS-class'>CRS</a></span>(<span class='no'>i</span>$<span class='no'>proj4</span>)
    <span class='no'>i.t</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/rgdal/topics/spTransform-methods'>spTransform</a></span>(<span class='no'>i</span>, <span class='fu'><a href='http://www.rdocumentation.org/packages/rgdal/topics/CRS-class'>CRS</a></span>(<span class='st'>'+proj=longlat +datum=WGS84'</span>))
    <span class='no'>i.c</span> <span class='kw'>&lt;-</span> <span class='fu'>as.matrix</span>(<span class='fu'>coordinates</span>(<span class='no'>i.t</span>))
    <span class='fu'>return</span>(<span class='fu'>data.frame</span>(<span class='kw'>x.new</span><span class='kw'>=</span><span class='no'>i.c</span>[, <span class='fl'>1</span>], <span class='kw'>y.new</span><span class='kw'>=</span><span class='no'>i.c</span>[, <span class='fl'>2</span>]))
  })

<span class='co'># merge in new coordinates</span>
<span class='no'>s</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/plyr/topics/join'>join</a></span>(<span class='no'>s</span>, <span class='no'>new.coords</span>)

<span class='co'># any changes?</span>
<span class='fu'>summary</span>(<span class='fu'>sqrt</span>(<span class='fu'>apply</span>((<span class='no'>s</span>[, <span class='fu'>c</span>(<span class='st'>'x'</span>, <span class='st'>'y'</span>)] - <span class='no'>s</span>[, <span class='fu'>c</span>(<span class='st'>'x.new'</span>, <span class='st'>'y.new'</span>)])^<span class='fl'>2</span>, <span class='fl'>1</span>, <span class='no'>sum</span>)))

<span class='co'># save to update file for use with "Import of Standard WGS84 Georeference" calculation in NASIS</span>
<span class='co'># note that this defines the coordinate source as "GPS", hence the last column of '1's.</span>
<span class='no'>std.coordinates.update.data</span> <span class='kw'>&lt;-</span> <span class='fu'>unique</span>(<span class='fu'>cbind</span>(<span class='no'>s</span>[, <span class='fu'>c</span>(<span class='st'>'siteiid'</span>, <span class='st'>'y.new'</span>, <span class='st'>'x.new'</span>)], <span class='fl'>1</span>))
<span class='co'># save to file</span>
<span class='fu'>write.table</span>(<span class='no'>std.coordinates.update.data</span>,
<span class='kw'>file</span><span class='kw'>=</span><span class='st'>'c:/data/sgeoref.txt'</span>, <span class='kw'>col.names</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>row.names</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>'|'</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    Jay M. Skovlin and Dylan E. Beaudette
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Dylan Beaudette, Jay Skovlin, Stephen Roecker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

