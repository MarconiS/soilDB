<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fetch commonly used site/pedon/horizon or component data from NASIS. — fetchNASIS • soilDB</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fetch commonly used site/pedon/horizon or component data from NASIS. — fetchNASIS" />
<meta property="og:description" content="Fetch commonly used site/pedon/horizon data or component from NASIS, returned as a SoilProfileCollection object." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">soilDB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fetch commonly used site/pedon/horizon or component data from NASIS.</h1>
    
    <div class="hidden name"><code>fetchNASIS.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fetch commonly used site/pedon/horizon data or component from NASIS, returned as a SoilProfileCollection object.</p>
    </div>

    <pre class="usage"><span class='fu'>fetchNASIS</span>(<span class='kw'>from</span> <span class='kw'>=</span> <span class='st'>'pedons'</span>, <span class='kw'>url</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>SS</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>rmHzErrors</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>nullFragsAreZero</span><span class='kw'>=</span><span class='fl'>TRUE</span>,
                  <span class='kw'>soilColorState</span><span class='kw'>=</span><span class='st'>'moist'</span>, <span class='kw'>lab</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>fill</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
                  <span class='kw'>stringsAsFactors</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>default.stringsAsFactors</a></span>()
                  )

<span class='fu'>getHzErrorsNASIS</span>(<span class='kw'>strict</span><span class='kw'>=</span><span class='fl'>TRUE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>from</th>
      <td><p>determines what objects should fetched? ('pedons' | 'components' | 'pedon_report')</p></td>
    </tr>
    <tr>
      <th>url</th>
      <td><p>string specifying the url for the NASIS pedon_report (default: NULL)</p></td>
    </tr>
    <tr>
      <th>SS</th>
      <td><p>fetch data from the currently loaded selected set in NASIS or from the entire local database (default: TRUE)</p></td>
    </tr>
    <tr>
      <th>stringsAsFactors</th>
      <td><p>logical: should character vectors be converted to factors? This argument is passed to the uncode() function. It does not convert those vectors that have been set outside of uncode() (i.e. hard coded). The 'factory-fresh' default is TRUE, but this can be changed by setting options(stringsAsFactors = FALSE)</p></td>
    </tr>
    <tr>
      <th>rmHzErrors</th>
      <td><p>should pedons with horizonation errors be removed from the results? (default: TRUE)</p></td>
    </tr>
    <tr>
      <th>nullFragsAreZero</th>
      <td><p>should fragment volumes of NULL be interpreted as 0? (default: TRUE), see details</p></td>
    </tr>
    <tr>
      <th>soilColorState</th>
      <td><p>which colors should be used to generate the convenience field 'soil_color'? ('moist' | 'dry')</p></td>
    </tr>
    <tr>
      <th>lab</th>
      <td><p>should the phlabresults child table be fetched with site/pedon/horizon data (default: FALSE)</p></td>
    </tr>
    <tr>
      <th>fill</th>
      <td><p>(fetchNASIS(from='components') only: include component records without horizon data in result? (default: FALSE)</p></td>
    </tr>
    <tr>
      <th>strict</th>
      <td><p>how strict should horizon boundaries be checked for consistency: TRUE=more | FALSE=less</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a SoilProfileCollection class object</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function imports data from NASIS into R as a S3 R object specified by the aqp R package, known as a soil profile collection object. It flattens NASIS's pedon and component tables, including their various child tables, into several more easily managable data frames. Primarily these functions access the local NASIS database using an ODBC connection. However using the fetchNASIS() argument from = "pedon_report", data can be read from the NASIS Report 'fetchNASIS', as either a txt file or url. The primary purpose of fetchNASIS(from = "pedon_report") is to faclitate importing datasets larger than 8000+ pedons/components.</p>
<p>The value of <code>nullFragsAreZero</code> will have a significant impact on the rock fragment fractions returned by <code>fetchNASIS</code>. Set <code>nullFragsAreZero = FALSE</code> in those cases where there are many data-gaps and NULL rock fragment values should be interpretated as NULLs. Set <code>nullFragsAreZero = TRUE</code> in those cases where NULL rock fragment values should be interpreted as 0.</p>
<p>This function attempts to do most of the boilerplate work when extracting site/pedon/horizon or component data from a local NASIS database. Pedons that are missing horizon data, or have errors in their horizonation are excluded from the returned object, however, their IDs are printed on the console. Pedons with combination horizons (e.g. B/C) are erroneously marked as errors due to the way in which they are stored in NASIS as two overlapping horizon records.</p>
<p>See <code>getHzErrorsNASIS</code> for a simple approach to identifying pedons with problematic horizonation.</p>
<p>See the <a href='http://ncss-tech.github.io/AQP/soilDB/NASIS-component-data.html'>NASIS component tutorial</a>, and <a href='http://ncss-tech.github.io/AQP/soilDB/fetchNASIS-mini-tutorial.html'>NASIS pedon tutorial</a> for more information.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'># check required packages</span>
<span class='kw'>if</span>(<span class='fu'><a href='https://rdrr.io/r/base/library.html'>require</a></span>(<span class='st'>"aqp"</span>) <span class='kw'>&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span>(<span class='st'>"RODBC"</span>)) {

  <span class='co'># test that NASIS db connection is set up</span>
  <span class='co'># note that you must setup this connection ahead of time</span>
  <span class='co'># see inst/doc/setup_ODBC_local_NASIS.pdf</span>
  <span class='kw'>if</span>(<span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span>(<span class='fu'><a href='https://rdrr.io/pkg/aqp/man/SoilProfileCollection-class.html'>names</a></span>(<span class='kw pkg'>RODBC</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/RODBC/man/odbcDataSources.html'>odbcDataSources</a></span>()), <span class='kw'>pattern</span><span class='kw'>=</span><span class='st'>"nasis_local"</span>))) {

    <span class='co'>## 1. fetchNASIS(from='pedon') NASIS setup</span>
    <span class='co'># query depends on some pedon data in your selected set</span>

    <span class='no'>f</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/try.html'>try</a></span>(<span class='fu'>fetchNASIS</span>(<span class='kw'>from</span> <span class='kw'>=</span> <span class='st'>'pedons'</span>))
    <span class='co'># note: wrap in try() to capture error in case of empty selected set</span>

    <span class='co'># plot only those profiles with densic contact</span>
    <span class='kw'>if</span>(!<span class='fu'><a href='https://rdrr.io/r/base/class.html'>inherits</a></span>(<span class='no'>f</span>,<span class='st'>'try-error'</span>)) {

      <span class='co'># which pedons have densic.contact==TRUE</span>
      <span class='no'>idx</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span>(<span class='no'>f</span>$<span class='no'>densic.contact</span>)

      <span class='co'># if there are any pedons with densic contacts, plot them</span>
      <span class='kw'>if</span>(<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>idx</span>))
        <span class='fu'><a href='https://rdrr.io/pkg/aqp/man/SPC-plotting.html'>plot</a></span>(<span class='no'>f</span>[<span class='no'>idx</span>, ], <span class='kw'>name</span><span class='kw'>=</span><span class='st'>'hzname'</span>)

    } <span class='kw'>else</span> { <span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span>(<span class='no'>f</span>[<span class='fl'>1</span>]) }

    <span class='co'>## 2. fetchNASIS(from='component') NASIS setup:</span>
    <span class='co'># perform a DMU-* query against the national database</span>

    <span class='no'>fc</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/try.html'>try</a></span>(<span class='fu'>fetchNASIS</span>(<span class='kw'>from</span> <span class='kw'>=</span> <span class='st'>'components'</span>))
    <span class='co'># note: wrap in try() to capture error in case of empty selected set</span>

    <span class='co'>## 3. fetchNASIS(from='pedon_report') NASIS setup:</span>
    <span class='co'># run the 11-IND NASIS report 'fetchNASIS' against the national database</span>
    <span class='co'># the result will automatically be opened and saved as fetchNASIS.txt</span>
    <span class='co'># in NASIS Temp folder</span>

    <span class='co'># the fetchNASIS.txt fileis read by fetchNASIS(from = 'pedon_report')</span>
    <span class='co'># alternate: run offline against national db and supply `url` argument</span>
    <span class='fu'><a href='https://rdrr.io/r/base/try.html'>try</a></span>(<span class='no'>f</span> <span class='kw'>&lt;-</span> <span class='fu'>fetchNASIS</span>(<span class='kw'>from</span> <span class='kw'>=</span> <span class='st'>'pedon_report'</span>))
    <span class='co'># note: wrap in try() to capture error in case of empty selected set</span>
  }
}</div><div class='output co'>#&gt; <span class='message'>Loading required namespace: RODBC</span></div><div class='output co'>#&gt; <span class='message'>multiple horizontal datums present, consider using WGS84 coordinates (x_std, y_std)</span></div><div class='output co'>#&gt; <span class='message'>NOTICE: multiple `labsampnum` values / horizons; see pedon IDs:</span>
#&gt; <span class='message'>1981IL115059,1990IL203027,77KY047001,C1805P01-1,S2003IL111005,S2006SC085002,S2011MI117102,V1985-VA023-309,V1985-VA023-311,V1985-VA023-312,V1985-VA023-314,V1985-VA023-317,V1985-VA023-319,V1985-VA161-328,V1985-VA161-332,V1985-VA161-334,V1985-VA163-321,V1985-VA163-322,V1985-VA163-326,V1985-VA173-337,V1985-VA173-339,V1985-VA173-342,V1985-VA173-343,V1985-VA173-345,V1985-VA173-346,V1985-VA191-349,V1985-VA191-350,V1985-VA191-356,V1985-VA197-341,V1985-VA197-360,V1985-VA197-361,V1985-VA770-329,V1985-VA770-333,V1985-VA775-335</span></div><div class='output co'>#&gt; <span class='message'>mixing dry colors ... [10 of 387 horizons]</span></div><div class='output co'>#&gt; <span class='message'>mixing moist colors ... [319 of 3436 horizons]</span></div><div class='output co'>#&gt; <span class='warning'>Warning: some records are missing rock fragment volume, these have been removed</span></div><div class='output co'>#&gt; <span class='message'>-&gt; QC: some fragsize_h values == 76mm, may be mis-classified as cobbles [91 / 3505 records]</span></div><div class='output co'>#&gt; <span class='warning'>Warning: some records are missing artifact volume, these have been removed</span></div><div class='output co'>#&gt; <span class='warning'>Warning: all records are missing artifact volume (NULL). buffering result with NA. will be converted to zero if nullFragsAreZero = TRUE.</span></div><div class='output co'>#&gt; <span class='message'>replacing missing lower horizon depths with top depth + 1cm ... [20 horizons]</span></div><div class='output co'>#&gt; <span class='message'>top/bottom depths equal, adding 1cm to bottom depth ... [11 horizons]</span></div><div class='output co'>#&gt; <span class='message'>-&gt; QC: sites without pedons: use `get('sites.missing.pedons', envir=soilDB.env)` for related usersiteid values</span></div><div class='output co'>#&gt; <span class='message'>-&gt; QC: duplicate pedons: use `get('dup.pedon.ids', envir=soilDB.env)` for related peiid values</span></div><div class='output co'>#&gt; <span class='message'>-&gt; QC: horizon errors detected, use `get('bad.pedon.ids', envir=soilDB.env)` for related userpedonid values or `get('bad.horizons', envir=soilDB.env)` for related horizon designations</span></div><div class='output co'>#&gt; <span class='message'>-&gt; QC: pedons missing bottom hz depths: use `get('missing.bottom.depths', envir=soilDB.env)` for related pedon IDs</span></div><div class='output co'>#&gt; <span class='message'>-&gt; QC: equal hz top and bottom depths: use `get('top.bottom.equal', envir=soilDB.env)` for related pedon IDs</span></div><div class='output co'>#&gt; <span class='warning'>Warning: No horizon data in NASIS component query result.</span></div><div class='img'><img src='fetchNASIS-1.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; Error in (function (classes, fdef, mtable)  : 
#&gt;   unable to find an inherited method for function 'site&lt;-' for signature '"data.frame"'
#&gt; Error in .fetchNASIS_report(url = url, rmHzErrors = rmHzErrors, nullFragsAreZero = nullFragsAreZero,  : 
#&gt;   the temp file C:/ProgramData/USDA/NASIS/Temp/fetchNASIS.txt
#&gt;  doesn't exist, please run the fetchNASIS report from NASIS</div><div class='input'># }
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>D. E. Beaudette, J. M. Skovlin, and S.M. Roecker</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Dylan Beaudette, Jay Skovlin, Stephen Roecker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


